function t(){const t=document.getElementById("calculateBtn");t.removeAttribute("disabled"),t.addEventListener("click",n)}function e(){const t=document.getElementById("dateInput");t&&(t.setAttribute("maxlength","10"),t.setAttribute("placeholder","дд.мм.гггг"),["input","paste"].forEach((e=>{t.addEventListener(e,c)})),t.addEventListener("paste",o),t.addEventListener("keydown",a))}function n(){const t=document.getElementById("dateInput");if(!t?.value)return;if(!/^\d{2}\.\d{2}\.\d{4}$/.test(t.value))return;h(t.value.replace(/\./g,"").split(""))}function o(t){t.preventDefault();const e=(t.clipboardData||window.clipboardData).getData("text");t.target.value=l(e)}function c(t){const{selectionStart:e,value:n}=t.target,o=n.length;t.target.value=l(n),r(t.target,e,o)}function r(t,e,n){const o=e+(t.value.length-n);t.setSelectionRange(o,o)}function a(t){if("Enter"===t.key)return t.preventDefault(),void n();i(t)||u(t)||s(t.key)||t.preventDefault()}function i(t){return["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(t.key)}function u(t){return t.ctrlKey||t.metaKey}function s(t){return/^\d$/.test(t)||"."===t}function l(t){let e=t.replace(/[^\d]/g,"");const n=e.slice(0,2),o=e.slice(2,4),c=e.slice(4);return p(d(n),f(o),c)}function d(t){return parseInt(t,10)>31?"31":t.length&&t[0]>"3"?("000"+parseInt(t,10)).slice(-2):t}function f(t){return parseInt(t,10)>12?"12":t.length&&t[0]>"1"?("000"+parseInt(t,10)).slice(-2):t}function p(t,e,n){const o=[];return t.length&&o.push(t),e.length&&o.push(e),n.length&&o.push(n),o.join(".")}function m(t){Object.entries(t).forEach((([t,e])=>{const n=document.querySelector(`#${t} .grid-item-content`);n&&(n.textContent=e)}))}function y(t,e){const n=document.getElementById("result"),o=document.getElementById("shareWhatsApp"),c=document.getElementById("copyBtn");if(!t||!e||!n)return;const r=`${[t.character??"—",t.energy??"—",t.interest??"—",t.health??"—",t.logics??"—",t.work??"—",t.luck??"—",t.debt??"—",t.memory??"—"].join("/")}/ЧС${e}`;n.textContent=r,o&&(o.style.display="block",o.onclick=()=>A(r)),c&&(c.style.display="block",c.onclick=()=>C(r))}function g(t,e,n){m({...t,additionalNumbers:e.join(", "),destiny:n}),y(t,n)}function h(t){const e=v(t),n=w(e[1]);g(L(I([...t,...e])),e,n)}function v(t){const e=[];return e[0]=E(t),e[1]=k(e[0]),e[2]=b(e[0],t),e[3]=k(e[2]),e}function k(t){return t.toString().split("").reduce(((t,e)=>t+parseInt(e,10)),0)}function E(t){return t.reduce(((t,e)=>t+parseInt(e,10)),0)}function b(t,e){const n=parseInt(e[0],10),o=parseInt(e[1],10),c=0===n?o:n;return Math.abs(t-2*c)}function I(t){return t.reduce(((t,e)=>(e.toString().split("").forEach((e=>{t.push(parseInt(e,10))})),t)),[])}function w(t){return 11===t?11:k(t)}function L(t){const e=B(t),n=x(e);return{...D(e),...$(n)}}function B(t){const e=new Array(9).fill(0);return t.forEach((t=>{t>=1&&t<=9&&e[t-1]++})),e}function x(t){return t.map(((t,e)=>t>0?`${e+1}`.repeat(t):"—"))}function D(t){return{temperament:t[2]+t[4]+t[6],target:t[0]+t[3]+t[6],family:t[1]+t[4]+t[7],habits:t[2]+t[5]+t[8],life:t[3]+t[4]+t[5]}}function $(t){return{character:t[0],energy:t[1],interest:t[2],health:t[3],logics:t[4],work:t[5],luck:t[6],debt:t[7],memory:t[8]}}function A(t){const e=encodeURIComponent(`Здравствуйте! Мне нужна ваша консультация по психоматрице. Вот результат расчета:\n${t}`);window.open(`https://wa.me/77015323869?text=${e}`,"_blank")}async function C(t){try{await navigator.clipboard.writeText(t);const e=document.getElementById("copyBtn"),n=e.style.backgroundColor;e.style.backgroundColor="#575e65",setTimeout((()=>{e.style.backgroundColor=n}),1e3)}catch(t){console.error("Failed to copy text: ",t),alert("Не удалось скопировать текст")}}document.addEventListener("DOMContentLoaded",(function(){t(),e()}));const S=document.getElementById("infoButton"),j=document.querySelector(".expert-info"),q=document.querySelector(".modal-close");function R(){j.classList.remove("modal-active"),document.body.style.overflow=""}S&&j&&q&&(S.addEventListener("click",(()=>{j.classList.add("modal-active"),document.body.style.overflow="hidden"})),q.addEventListener("click",(t=>{t.stopPropagation(),R()})),document.addEventListener("click",(t=>{!j.classList.contains("modal-active")||j.contains(t.target)||t.target===S||S.contains(t.target)||R()})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&j.classList.contains("modal-active")&&R()})));